---
- name: Install OpenJDK 8 
  apt: 
    name: openjdk-8-jdk 
    update_cache: yes
  tags: install-openjdk 

- name: Download Keycloak From Official Site
  get_url:
    url: https://downloads.jboss.org/keycloak/10.0.2/keycloak-10.0.2.zip
    dest: /tmp/keycloak.zip
    mode: '0644'

- name: Extract File Keycloak
  unarchive:
    src: /tmp/keycloak.zip
    dest: /tmp/
    remote_src: yes

- name: Move Keycloak To OPT Directory
  command: mv /tmp/keycloak-10.0.2 /opt/keycloak

- name: Add User Keycloak
  user:
    name: keycloak
    comment: keycloak

#- name: Create Group Keycloak And Put Keycloak User To That Group 
#  command: "{{ item }}"
#  with_items: 
#    - groupadd keycloak
#    - useradd -r -g keycloak -d /opt/keycloak -s /sbin/nologin keycloak
 
- name: Change Ownership of the Keycloak Installation Directory
  file:
    path: /opt/keycloak
    state: directory
    recurse: yes
    owner: keycloak
    group: keycloak

- name: Change Permission of the Keycloak Installation Directory
  file:
    path: /opt/keycloak/bin
    state: directory
    recurse: yes
    mode: '0755'

- name: Copy wildfly.conf From Keycloak Docs To etc Directory
  template: 
    src: wildfly.conf.j2
    dest: /etc/keycloak/keycloak.conf
    mode: '0644'
  tags:
    - config

- name: Copy File launch.sh To Instalation Directory
  template:
    src: launch.sh.j2
    dest: /opt/keycloak/bin/launch.sh
    owner: keycloak
    group: keycloak
    mode: '755' 
  tags:
    - config

- name: Copy wildfly.service To systemd Directory
  template: 
    src: wildfly.service.j2
    dest: /etc/systemd/system/keycloak.service 
    mode: '0644'
  tags:
    - config




    
